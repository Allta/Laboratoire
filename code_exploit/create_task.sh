#!/bin/bash 

#
# Script qui est lancé par le user sans privilège en sudo pour écrire dans le dossier
# ou script en root avec droit d'éxécution à tout le monde
# en readonly qui possède les taches d'administration
# Création d'un fichier : 00-tototo.sh\;command\;.sh
#
REGEX="^[0-9]{2}-[a-z]{6}\.sh"
menu_path="/netsec/Laboratoire/code_exploit/menu_entry"
PS3="Please select an admin task : "


function print_usage(){
cat << EOF
-- 
Usage : $0 -f {filename} -c "{your command here}"
EOF
}

[[ $# -lt 1 ]] && print_usage

while getopts "f:c:" option
do 
	case "${option}" in
		f) task_name="$OPTARG"
		;;
#		c) command_name="$OPTARG"
#		;;
		*) print_usage
		;;
	esac
done


task_number=$(ls ${menu_path} | wc -l)
task_number=$((task_number+1))
[[ $task_number -le 9 ]] && task_number="0$task_number"

task_file="${task_number}-${task_name}.sh"

#[[ ${task_file} =~ ${REGEX} ]] &&  echo "${command_name}" >> ${menu_path}/${task_file} 

declare -a task_array
task_array=(archive top who process)

select task in "${task_array[@]}"
do
	case ${task} in 
		archive) cmd='tar cvzf /var/www/html/backup-$(date "+%y%m%d").tar.gz /var/www/html/wordpress'
		;;
		top)
		;;
		who)
		;;
		process)
		;;
	esac
	echo ${task_file}
	if [[ ${task_file} =~ ${REGEX} ]];then 
		echo "${cmd}" >> ${menu_path}/${task_file}
		chmod 744 ${menu_path}/${task_file}
	exit
	fi 	
done


